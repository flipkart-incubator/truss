!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Truss=n():e.Truss=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0}),n.PubSubHelper=void 0;var i=t(3),o=r(i),u=t(4);n.PubSubHelper=new o.default;n.default={createInstance:u.createInstance,destroyModuleInstance:u.destroyModuleInstance,use:u.use}},function(e,n){"use strict";function t(e,n){for(var t=-1,r=e.length;++t<r&&n.indexOf(e.charAt(t))>-1;);return t}function r(e,n){for(var t=e.length;t--&&n.indexOf(e.charAt(t))>-1;);return t}function i(e){if(a){var n=document.createEvent("Event",{detail:e});n.initEvent("trussExtensionsEvents",!0,!0),a.dispatchEvent(n)}}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},u=-1,a=document.getElementById("trussExtensionsEventDiv");n.default={communicateToExtension:i,getNextUniqueId:function(){return"UIF-"+ ++u},pick:function(e,n){var t={};return n.forEach(function(n){t[n]=e[n]}),t},length:function(e){return Array.isArray(e)?e.length:"object"===(void 0===e?"undefined":o(e))?Object.keys(e).length:"string"==typeof e?e.length:0},trim:function(e,n){return e.slice(t(e,n),r(e,n)+1)},clearSlashes:function(e){return this.trim(e,"/")},partial:function(e){var n=Array.prototype.slice,t=n.call(arguments,1);return function(){return e.apply(this,t.concat(n.call(arguments,0)))}},getCSSSelector:function(e,n){try{for(var t=""+e.instanceConfig.container,r=e.meta.parent&&e.meta.parent.pointer?e.meta.parent.pointer:void 0;r;)t=r.instanceConfig.container+" "+t,r=r.parent&&r.parent.pointer?r.parent.pointer.meta.id:void 0;return t}catch(i){return""}}}},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r=t([],{insertInstance:function(e){this.push(e)},deleteInstance:function(e){for(var n=this.length-1;n>=0;n--)if(this[n].meta.id===e){this.splice(n,1);break}},findInstance:function(e,n){return e?this.filter(function(n){return n.meta.id===e?n:void 0}):n?this.filter(function(e){return e.name===n?e:void 0}):[]}}),i="undefined"!=typeof window,o=!i,u={},a={store:[]},l=[];n.isBrowser=i,n.subscriptions=u,n.moduleS=r,n.isServer=o,n.eventQ=a,n.middleWareFns=l},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;n.length>t;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),u=t(1),a=r(u),l=t(2),c=function(){function e(){i(this,e)}return o(e,[{key:"subscribe",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.eventName;l.subscriptions[n]||(l.subscriptions[n]=[]);var t=a.default.pick(e,["callback","context","eventSubscriber","eventPublisher","once","type"]);l.subscriptions[n].push(t)}},{key:"publish",value:function(e,n){var t="";3===arguments.length?(t=arguments[0]||"",e=arguments[1],n=arguments[2]):t=a.default.getCSSSelector(this);var r=l.subscriptions[e],i=[];if(r){var o=r.filter(function(e){return"RE_PLAY"===e.type?e:void 0});o.length&&l.eventQ.store.push({eventName:e,message:n,publisher:t}),r&&r.length&&r.forEach(function(r){var o=r.callback,u=r.context,a=r.once,c=!1;if(r.eventPublisher){var s=RegExp(r.eventPublisher+"$");if(s.test(t))c=!0;else{for(var f=t.split(" "),d=r.eventPublisher.split(" "),p=f.length,v=d.length;f.length&&d.length;)p=f.length,v=d.length,f[p-1]===d[v-1]?(f.pop(),d.pop()):f.pop();d.length||(c=!0)}}if(!r.eventPublisher||c){var h=n;"RE_PLAY"===r.type&&(h=l.eventQ.store.filter(function(n){return n.publisher===t&&n.eventName===e?n:void 0}).map(function(e){return e.message})),o.call(u?u:null,h),a||i.push(r)}else i.push(r)}),l.subscriptions[e]=i}}},{key:"unsubscribe",value:function(e,n,t){var r=l.subscriptions[n];if(r){var i=r.filter(function(e){return"RE_PLAY"===e.type?e:void 0});l.subscriptions[n]=r.filter(function(n){return!(n.callback===t&&n.eventSubscriber===e)}),i.length&&(l.subscriptions[n].length||(l.eventQ.store=l.eventQ.store.filter(function(e){return e.eventName!==n?e:void 0})))}}}]),e}();n.default=c},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,t=void 0;return t="string"==typeof e?f.moduleS.findInstance(e):e.meta?f.moduleS.findInstance(e.meta.id):f.moduleS.findInstance(null,e.name),t.forEach(function(e){e[p.default.MODULE_EVENTS.destroy]&&e[p.default.MODULE_EVENTS.destroy]();var t=n.document.querySelector("#"+e.getUniqueId());t&&t.remove();var r=e.getAllSubscriptions();if(r.forEach(function(n){e.unsubscribe(n.eventName,n.callback)}),e.meta.children&&e.meta.children.length){var o=e.meta.children.map(function(e){return e.pointer});e.meta.children=[],o.forEach(function(e){i(e)})}f.moduleS.deleteInstance(e.meta.id)}),!0}function o(e){var n=[],t=void 0,r=[];return S.call(this,e.moduleName,e,e.module,e.instanceConfig,r),y.call(this,r,n),l.default.communicateToExtension(f.moduleS),t=new Promise(function(e,t){Promise.all(n).then(function(){e()})})}function u(e){f.middleWareFns.push(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.destroyModuleInstance=i,n.createInstance=o,n.use=u;var a=t(1),l=r(a),c=t(6),s=r(c),f=t(2),d=t(5),p=r(d),v=function(e,n){e[p.default.MODULE_EVENTS.onStatusChange]&&e[p.default.MODULE_EVENTS.onStatusChange](n)},h=function(e,n){e.publish(""+e.getModuleName()+n,{moduleInstanceId:e.getUniqueId()})},m=function(e){return e.instanceConfig.initOn&&e.lifeCycleFlags.rendered?Promise.resolve(e.path):b(e)},b=function(e,n){if(s.default.createModuleArena(e),e[p.default.MODULE_EVENTS.resolveRenderOn]){var t=e[p.default.MODULE_EVENTS.resolveRenderOn](n);return t instanceof Promise?t.then(function(n){return e.lifeCycleFlags.preRenderResolved=!0,v(e,p.default.onStatusChange_EVENTS.resolveRenderOnCalled),E(e,n)}):(v(e,p.default.onStatusChange_EVENTS.resolveRenderOnCalled),E(e,e[p.default.MODULE_EVENTS.resolveRenderOn](n)))}return E(e)},E=function(e,n){return e.instanceConfig.listensTo&&e.instanceConfig.listensTo.length&&e.instanceConfig.listensTo.filter(function(e){return e.type!==p.default.EVENT_ENUM.playAfterRender&&e.type?void 0:e}).forEach(function(n){e.subscribe({eventName:n.eventName,callback:e[n.callback],context:e,eventPublisher:n.eventPublisher,once:n.once})}),v(e,p.default.onStatusChange_EVENTS.listensToPlayAfterRenderSubscribed),g(e,n)},g=function(e,n){return new Promise(function(t,r){var i=e[p.default.MODULE_EVENTS.render](n,i);v(e,p.default.onStatusChange_EVENTS.renderCalled),e[p.default.MODULE_EVENTS.onRenderComplete]&&(e[p.default.MODULE_EVENTS.onRenderComplete](),v(e,p.default.onStatusChange_EVENTS.onRenderCompleteCalled)),t(e.path,i),e.lifeCycleFlags.rendered=!0,h(e,"_READY")})},y=function _(e,n){var t=e.filter(function(e){return!e.meta.parent.id});t.length||(t=[e[0]]),t.forEach(function(e){var t=new Promise(function(t,r){m(e).then(function(){t(),e.meta.children&&e.meta.children.forEach(function(e){_([e.pointer],n)})})});n.push(t)})},C=function(e){return e.instanceConfig.initOn&&e.subscribe({eventName:e.instanceConfig.initOn.eventName,eventPublisher:e.instanceConfig.initOn.eventPublisher,context:e.instanceConfig,callback:l.default.partial(b,e)}),v(e,p.default.onStatusChange_EVENTS.initOnSubscribed),e.instanceConfig.listensTo&&e.instanceConfig.listensTo.length&&e.instanceConfig.listensTo.filter(function(e){return e.type===p.default.EVENT_ENUM.keepOn||e.type===p.default.EVENT_ENUM.replay?e:void 0}).forEach(function(n){e.subscribe({eventName:n.eventName,callback:e[n.callback],context:e,eventPublisher:n.eventPublisher,once:n.once,type:n.type})}),v(e,p.default.onStatusChange_EVENTS.keepOnReplaySubscribed),Promise.resolve(e.path)},S=function O(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.module,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.instanceConfig,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=this,u=arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:u&&u.meta,c=n.name?n.name.split("."):void 0,d=void 0;this instanceof s.default?!function(){var e=o.getUniqueId();d=f.moduleS.filter(function(n){return n.meta.id===e})}():!u&&c&&2===c.length&&(d=f.moduleS.filter(function(e){return e.name===c[0]})),d&&d.length&&(u=d[0],a=u.meta);var m={id:l.default.getNextUniqueId(),parent:{id:a&&a.id?a.id:void 0,pointer:u},children:[],siblings:a?[].concat(a.children):[]},b=new s.default(n.name,e,p.default.lifeCycleFlags,r,t,m);return h(b,"_CREATED"),v(b,p.default.onStatusChange_EVENTS.onCreate),f.moduleS.insertInstance(b),i.push(b),C(b),a&&(m.siblings=[].concat(a.children),a.children.push({id:m.id,pointer:b})),t.config&&t.config.modules&&t.config.modules.length?void t.config.modules.forEach(function(e){O(e.moduleName,e,e.module,e.instanceConfig,i,b)}):i};n.default={createInstance:o,destroyModuleInstance:i,use:u}},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={EVENT_ENUM:{keepOn:"KEEP_ON",replay:"RE_PLAY",playAfterRender:"PLAY_AFTER_RENDER"},MODULE_EVENTS:{resolveRenderOn:"resolveRenderOn",render:"render",onRenderComplete:"onRenderComplete",onStatusChange:"onStatusChange",destroy:"destroy"},onStatusChange_EVENTS:{onCreate:"LIFECYCLE:CREATED",keepOnReplaySubscribed:"LIFECYCLE:KEEP_ON_&_REPLAY_SUBSCRIBED",initOnSubscribed:"LIFECYCLE:INIT_ON_SUBSCRIBED",resolveRenderOnCalled:"LIFECYCLE:RESOLVE_RENDER_ON_CALLED",listensToPlayAfterRenderSubscribed:"LIFECYCLE:LISTENS_TO_PLAY_AFTER_RENDER_SUBSCRIBED",renderCalled:"LIFECYCLE:ON_RENDER_CALLED",onRenderCompleteCalled:"LIFECYCLE:ON_RENDER_CAOMPLETE_CALLED"},lifeCycleFlags:{booted:!0,preRenderResolved:!1,rendered:!1}}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function u(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},c=function(){function e(e,n){for(var t=0;n.length>t;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),s=function E(e,n,t){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:E(i,n,t)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(t)},f=t(1),d=r(f),p=t(2),v=t(3),h=r(v),m=t(4),b=function(){var e=new WeakMap,n=function(n){function t(n,r,u,a,c,s){i(this,t);var f=o(this,Object.getPrototypeOf(t).call(this));p.middleWareFns.forEach(function(e){l(f,e(f))}),f.moduleName=r,f.name=n,f.lifeCycleFlags=u,f.instanceConfig=a,f.modulePlaceholders=f.instanceConfig.placeholders,f.createInstance=m.createInstance.bind(f),f.meta=s;for(var d in c)f[d]=c[d];return e.set(f,{moduleSubscriptions:[],uniqueId:s.id}),f}return u(t,n),c(t,[{key:"render",value:function(e){var n=this.getUniqueId(),t=e||this.instanceConfig.placeholders;document.querySelector("#"+n).innerHTML=this.template(t)}},{key:"getAllSubscriptions",value:function(){return e.get(this).moduleSubscriptions}},{key:"getUniqueId",value:function(){return e.get(this).uniqueId}},{key:"getParentInstanceId",value:function(){return this.meta.parent?this.meta.parent.id:""}},{key:"getModuleContainer",value:function(){return"#"+this.getUniqueId()}},{key:"getModuleName",value:function(){return this.moduleName}},{key:"getInstanceConfig",value:function(){return this.instanceConfig.placeholders}},{key:"getCSSSelector",value:function(){return d.default.getCSSSelector(this,p.moduleS)}},{key:"destroy",value:function(){}},{key:"subscribe",value:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.eventName;n.eventSubscriber=this.getModuleContainer(),e.get(this).moduleSubscriptions.push(n),s(Object.getPrototypeOf(t.prototype),"subscribe",this).call(this,n,r)}},{key:"publish",value:function(e,n){s(Object.getPrototypeOf(t.prototype),"publish",this).call(this,e,n)}},{key:"unsubscribe",value:function(e,n){"object"===(void 0===e?"undefined":a(e))&&(n=e.callback,e=e.eventName),s(Object.getPrototypeOf(t.prototype),"unsubscribe",this).call(this,this.getModuleContainer(),e,n)}}],[{key:"createModuleArena",value:function(e,n){var t="";return t=e.instanceConfig.moduleClassName?e.instanceConfig.theme?e.instanceConfig.moduleClassName+"-"+e.instanceConfig.theme:e.instanceConfig.moduleClassName+"-default":e.instanceConfig.theme?e.moduleName+"-"+e.instanceConfig.theme:e.moduleName+"-default","string"!=typeof n?void(document.querySelector(e.instanceConfig.container).innerHTML='<div id="'+e.getUniqueId()+'" class="'+t+' play-arena"></div>'):(""===n.trim()&&(n='<div id="'+e.getUniqueId()+'"></div>'),n)}}]),t}(h.default);return n}();n.default=b}])});