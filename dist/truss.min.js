!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Truss=t():e.Truss=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,n=f.moduleS.findInstance(e);n.forEach(function(e){var n=e.getAllSubscriptions();n.forEach(function(t){e.unsubscribe(t.eventName,t.callback)}),t.document.querySelector("#"+e.getUniqueId()).parentNode.remove()}),f.moduleS.deleteInstance(e);var r=f.moduleS.filter(function(t){return t.path.indexOf(e+".")>-1?t:void 0});return r.forEach(function(e){f.moduleS.deleteInstance(e.moduleName)}),!0}function i(e){var t=[],n=void 0;return P(e,e.moduleName,e.module,e.instanceConfig),_(null,t),n=new u.Promise(function(e,n){u.Promise.all(t).then(function(){e()})})}Object.defineProperty(t,"__esModule",{value:!0}),t.destroyModuleInstance=o,t.createInstance=i;var u=n(5),s=n(1),c=r(s),a=n(3),l=r(a),f=n(2),h="KEEP_ON",d="RE_PLAY",p="PLAY_AFTER_RENDER",v={booted:!0,preRenderResolved:!1,rendered:!1},g=function(e){return e.instanceConfig.initOn&&e.lifeCycleFlags.rendered?u.Promise.resolve(e.path):y(e)},y=function(e){return e.resolveRenderOn?e.resolveRenderOn().then(function(t){return e.lifeCycleFlags.preRenderResolved=!0,b(e,t)}):b(e)},b=function(e,t){return e.instanceConfig.listensTo&&e.instanceConfig.listensTo.length&&e.instanceConfig.listensTo.filter(function(e){return e.type!==p&&e.type?void 0:e}).forEach(function(t){e.subscribe({eventName:t.eventName,callback:e[t.callback],context:e,eventPublisher:t.eventPublisher,once:t.once})}),m(e,t)},m=function(e,t){return console.log("_callRender called for: "+e.moduleName),l.default.createModuleArena(e),new u.Promise(function(n,r){var o=e.render(t,o);e.instanceConfig.onRenderCompelete&&e.onRenderCompelete(),n(e.path,o),e.lifeCycleFlags.rendered=!0})},_=function S(e,t){var n=void 0;e||(e=f.moduleS.filter(function(e){return 1===e.path.split(".").length}),f.isBrowser&&(n=void 0)),e.forEach(function(e){var n=new u.Promise(function(n,r){g(e).then(function(r){n();var o=c.default.getLevelsFromPath(e.path),i=f.moduleS.filter(function(e){return e.path.indexOf(r+".")>-1&&c.default.getLevelsFromPath(e.path)===o+1});S(i,t)})});t.push(n)})},w=function(e){return e.instanceConfig.initOn&&e.subscribe({eventName:e.instanceConfig.initOn.eventName,eventPublisher:e.instanceConfig.initOn.eventPublisher,context:e.instanceConfig,callback:c.default.partial(y,e)}),e.instanceConfig.listensTo&&e.instanceConfig.listensTo.length&&e.instanceConfig.listensTo.filter(function(e){return e.type===h||e.type===d?e:void 0}).forEach(function(t){e.subscribe({eventName:t.eventName,callback:e[t.callback],context:e,eventPublisher:t.eventPublisher,once:t.once,type:t.type})}),u.Promise.resolve(e.path)},P=function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.moduleName,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.module,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.instanceConfig,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(!o&&(o=t,f.moduleS.findInstance(null,"moduleName",t).length>0))return void console.log("Module ("+t+") is already registered at same path. Skipping...");if(o&&f.moduleS.findInstance(o).length>0)return void console.log("Module ("+t+") is already registered at same path. Skipping...");var i=new l.default(t,c.default.getNextUniqueId(),o,v,r,n);f.moduleS.insertInstance(i),w(i),n.config&&n.config.modules&&n.config.modules.length&&n.config.modules.forEach(function(e){O(e,void 0,void 0,void 0,o+"."+e.moduleName)})};t.default={createInstance:i,destroyModuleInstance:o}},function(e,t){"use strict";function n(e,t){for(var n=-1,r=e.length;++n<r&&t.indexOf(e.charAt(n))>-1;);return n}function r(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i=-1;t.default={getLevelsFromPath:function(e,t){return(e.match(RegExp("\\.","g"))||[]).length},getNextUniqueId:function(){return"UIF-"+ ++i},pick:function(e,t){var n={};return t.forEach(function(t){n[t]=e[t]}),n},length:function(e){return Array.isArray(e)?e.length:"object"===(void 0===e?"undefined":o(e))?Object.keys(e).length:"string"==typeof e?e.length:0},trim:function(e,t){return e.slice(n(e,t),r(e,t)+1)},clearSlashes:function(e){return this.trim(e,"/")},partial:function(e){var t=Array.prototype.slice,n=t.call(arguments,1);return function(){return e.apply(this,n.concat(t.call(arguments,0)))}},getCSSSelector:function(e){var t=e.instanceConfig;return t.container+" "+e.getUniqueId()}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r=n([],{insertInstance:function(e,t){var n=void 0;n=t?this.getObjByPath(t):this,n.push(e)},deleteInstance:function(e){for(var t=this.length-1;t>=0;t--)if(this[t].moduleName===e){this.splice(t,1);break}},findInstance:function(e){return this.filter(function(t){return t.moduleName===e?t:void 0})},overrideInstance:function(e,t,n,r,o){var i=void 0;i=e?this.getObjByPath(e):this;for(var u in r)i[u]=r[u]}}),o="undefined"!=typeof window,i=!o,u={},s={store:[]};t.isBrowser=o,t.subscriptions=u,t.moduleS=r,t.isServer=i,t.eventQ=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function v(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:v(o,t,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},a=n(1),l=r(a),f=n(2),h=n(4),d=r(h),p=function(){var e=new WeakMap,t=function(t){function n(t,r,u,s,c,a){o(this,n);var l=i(this,Object.getPrototypeOf(n).call(this));l.moduleName=t,l.path=u,l.lifeCycleFlags=s,l.instanceConfig=c;for(var f in a)l[f]=a[f];return e.set(l,{moduleSubscriptions:[],uniqueId:r}),l}return u(n,t),s(n,[{key:"render",value:function(e){var t=this.getUniqueId(),n=e||this.instanceConfig.placeholders;document.querySelector("#"+t).innerHTML=this.template(n)}},{key:"getAllSubscriptions",value:function(){return e.get(this).moduleSubscriptions}},{key:"getUniqueId",value:function(){return e.get(this).uniqueId}},{key:"getParentInstanceId",value:function(){var e=this.path.split(".");e.pop();var t=e.join("."),n=f.moduleS.filter(function(e){return e.path===t?e.getUniqueId():void 0});return n.length?n[0].getUniqueId():""}},{key:"getModuleContainer",value:function(){return"#"+this.getUniqueId()}},{key:"getModuleName",value:function(){return this.moduleName}},{key:"getInstanceConfig",value:function(){return this.instanceConfig.placeholders}},{key:"getCSSSelector",value:function(){return l.default.getCSSSelector()}},{key:"destroy",value:function(){}},{key:"subscribe",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.eventName;t.eventSubscriber=this.getModuleContainer(),e.get(this).moduleSubscriptions.push(t),c(Object.getPrototypeOf(n.prototype),"subscribe",this).call(this,t,r)}},{key:"publish",value:function(e,t){c(Object.getPrototypeOf(n.prototype),"publish",this).call(this,e,t)}},{key:"unsubscribe",value:function(e,t){c(Object.getPrototypeOf(n.prototype),"unsubscribe",this).call(this,this.getModuleContainer(),e,t)}}],[{key:"createModuleArena",value:function(e,t){return"string"!=typeof t?void(document.querySelector(e.instanceConfig.container).innerHTML='<div id="'+e.getUniqueId()+'"></div>'):(""===t.trim()&&(t='<div id="'+e.getUniqueId()+'"></div>'),t)}}]),n}(d.default);return t}();t.default=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),s=r(u),c=n(2),a=function(){function e(){o(this,e)}return i(e,[{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.eventName;c.subscriptions[t]||(c.subscriptions[t]=[]);var n=s.default.pick(e,["callback","context","eventSubscriber","eventPublisher","once","type"]);c.subscriptions[t].push(n)}},{key:"publish",value:function(e,t){var n=s.default.getCSSSelector(this),r=c.subscriptions[e],o=[],i=r.filter(function(e){return"RE_PLAY"===e.type?e:void 0});i.length&&c.eventQ.store.push({eventName:e,message:t,publisher:n}),r&&r.length&&r.forEach(function(r){var i=r.callback,u=r.context,s=r.once,a=!1;if(r.eventPublisher){var l=RegExp(r.eventPublisher+"$");if(l.test(n))a=!0;else{for(var f=n.split(" "),h=r.eventPublisher.split(" "),d=f.length,p=h.length;f.length&&h.length;)d=f.length,p=h.length,f[d-1]===h[p-1]?(f.pop(),h.pop()):f.pop();h.length||(a=!0)}}if(!r.eventPublisher||a){var v=t;"RE_PLAY"===r.type&&(v=c.eventQ.store.filter(function(t){return t.publisher===n&&t.eventName===e?t:void 0}).map(function(e){return e.message})),i.call(u?u:null,v),s||o.push(r)}else o.push(r)}),c.subscriptions[e]=o}},{key:"unsubscribe",value:function(e,t,n){var r=c.subscriptions[t],o=r.filter(function(e){return"RE_PLAY"===e.type?e:void 0});c.subscriptions[t]=r.filter(function(t){return!(t.callback===n&&t.eventSubscriber===e)}),o.length&&(c.subscriptions[t].length||(c.eventQ.store=c.eventQ.store.filter(function(e){return e.eventName!==t?e:void 0})))}}]),e}();t.default=a},function(e,t,n){var r;(function(e,o,i){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
	 * @version   3.1.2
	 */
(function(){"use strict";function u(e){return"function"==typeof e||"object"==typeof e&&null!==e}function s(e){return"function"==typeof e}function c(e){$=e}function a(e){V=e}function l(){return function(){e.nextTick(v)}}function f(){return function(){W(v)}}function h(){var e=0,t=new ee(v),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function d(){var e=new MessageChannel;return e.port1.onmessage=v,function(){e.port2.postMessage(0)}}function p(){return function(){setTimeout(v,1)}}function v(){for(var e=0;J>e;e+=2){var t=re[e],n=re[e+1];t(n),re[e]=void 0,re[e+1]=void 0}J=0}function g(){try{var e=n(9);return W=e.runOnLoop||e.runOnContext,f()}catch(t){return p()}}function y(e,t){var n=this,r=n._state;if(r===se&&!e||r===ce&&!t)return this;var o=new this.constructor(m),i=n._result;if(r){var u=arguments[r-1];V(function(){R(r,o,u,i)})}else I(n,o,e,t);return o}function b(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(m);return A(n,e),n}function m(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function w(){return new TypeError("A promises callback cannot return that same promise.")}function P(e){try{return e.then}catch(t){return ae.error=t,ae}}function S(e,t,n,r){try{e.call(t,n,r)}catch(o){return o}}function O(e,t,n){V(function(e){var r=!1,o=S(n,t,function(n){r||(r=!0,t!==n?A(e,n):j(e,n))},function(t){r||(r=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,x(e,o))},e)}function k(e,t){t._state===se?j(e,t._result):t._state===ce?x(e,t._result):I(t,void 0,function(t){A(e,t)},function(t){x(e,t)})}function C(e,t,n){t.constructor===e.constructor&&n===oe&&constructor.resolve===ie?k(e,t):n===ae?x(e,ae.error):void 0===n?j(e,t):s(n)?O(e,t,n):j(e,t)}function A(e,t){e===t?x(e,_()):u(t)?C(e,t,P(t)):j(e,t)}function E(e){e._onerror&&e._onerror(e._result),N(e)}function j(e,t){e._state===ue&&(e._result=t,e._state=se,0!==e._subscribers.length&&V(N,e))}function x(e,t){e._state===ue&&(e._state=ce,e._result=t,V(E,e))}function I(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+se]=n,o[i+ce]=r,0===i&&e._state&&V(N,e)}function N(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,o,i=e._result,u=0;t.length>u;u+=3)r=t[u],o=t[u+n],r?R(n,r,o,i):o(i);e._subscribers.length=0}}function M(){this.error=null}function T(e,t){try{return e(t)}catch(n){return le.error=n,le}}function R(e,t,n,r){var o,i,u,c,a=s(n);if(a){if(o=T(n,r),o===le?(c=!0,i=o.error,o=null):u=!0,t===o)return void x(t,w())}else o=r,u=!0;t._state!==ue||(a&&u?A(t,o):c?x(t,i):e===se?j(t,o):e===ce&&x(t,o))}function q(e,t){try{t(function(t){A(e,t)},function(t){x(e,t)})}catch(n){x(e,n)}}function L(e){return new ge(this,e).promise}function U(e){function t(e){A(o,e)}function n(e){x(o,e)}var r=this,o=new r(m);if(!G(e))return x(o,new TypeError("You must pass an array to race.")),o;for(var i=e.length,u=0;o._state===ue&&i>u;u++)I(r.resolve(e[u]),void 0,t,n);return o}function F(e){var t=this,n=new t(m);return x(n,e),n}function Y(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Q(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function B(e){this._id=pe++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==e&&("function"!=typeof e&&Y(),this instanceof B?q(this,e):Q())}function D(e,t){this._instanceConstructor=e,this.promise=new e(m),Array.isArray(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=Array(this.length),0===this.length?j(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&j(this.promise,this._result))):x(this.promise,this._validationError())}function H(){var e;if(void 0!==o)e=o;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;n&&"[object Promise]"===Object.prototype.toString.call(n.resolve())&&!n.cast||(e.Promise=ve)}var K;K=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var W,$,z,G=K,J=0,V=function(e,t){re[J]=e,re[J+1]=t,J+=2,2===J&&($?$(v):z())},X="undefined"!=typeof window?window:void 0,Z=X||{},ee=Z.MutationObserver||Z.WebKitMutationObserver,te=void 0!==e&&"[object process]"==={}.toString.call(e),ne="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,re=Array(1e3);z=te?l():ee?h():ne?d():void 0===X?g():p();var oe=y,ie=b,ue=void 0,se=1,ce=2,ae=new M,le=new M,fe=L,he=U,de=F,pe=0,ve=B;B.all=fe,B.race=he,B.resolve=ie,B.reject=de,B._setScheduler=c,B._setAsap=a,B._asap=V,B.prototype={constructor:B,then:oe,"catch":function(e){return this.then(null,e)}};var ge=D;D.prototype._validationError=function(){return Error("Array Methods must be provided an Array")},D.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===ue&&e>n;n++)this._eachEntry(t[n],n)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===ie){var o=P(e);if(o===oe&&e._state!==ue)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===ve){var i=new n(m);C(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===ue&&(this._remaining--,e===ce?x(r,n):this._result[t]=n),0===this._remaining&&j(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;I(e,void 0,function(e){n._settledAt(se,t,e)},function(e){n._settledAt(ce,t,e)})};var ye=H,be={Promise:ve,polyfill:ye};n(7).amd?(r=function(){return be}.call(t,n,t,i),!(void 0!==r&&(i.exports=r))):void 0!==i&&i.exports?i.exports=be:void 0!==this&&(this.ES6Promise=be),ye()}).call(this)}).call(t,n(6),function(){return this}(),n(8)(e))},function(e,t){function n(){a&&u&&(a=!1,u.length?c=u.concat(c):l=-1,c.length&&r())}function r(){if(!a){var e=setTimeout(n);a=!0;for(var t=c.length;t;){for(u=c,c=[];++l<t;)u&&u[l].run();l=-1,t=c.length}u=null,a=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function i(){}var u,s=e.exports={},c=[],a=!1,l=-1;s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;arguments.length>n;n++)t[n-1]=arguments[n];c.push(new o(e,t)),1!==c.length||a||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=i,s.addListener=i,s.once=i,s.off=i,s.removeListener=i,s.removeAllListeners=i,s.emit=i,s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t){e.exports=function(){throw Error("define cannot be used indirect")}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){}])});